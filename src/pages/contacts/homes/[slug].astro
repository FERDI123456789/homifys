---
import { Picture } from "astro:assets";
import Layout from "../../../layouts/Layout.astro";
import rating from "../../../assets/men6.jpg";
import directus from "../../../lib/directus";
import "../../../styles/global.css";
import { readItems } from "@directus/sdk";

export async function getStaticPaths() {
  const posts = await directus.request(
    readItems("posts", {
      fields: [
        "slug",
        "image",
        "text",
        "ratings",
        "price",
        "location",
        "published_date",
        { author: ["slug", "name", "about", "avatar", "ratings_authors", "achieve", "achieve_two", "check_value"] },
      ],
      sort: ["-ratings"],
    })
  );
  return posts.map((auth) => ({ params: { slug: auth.author.slug }, props: auth }));
}

const auth = Astro.props;

const posts = await directus.request(
  readItems("posts", {
    fields: [
      "slug",
      "image",
      "text",
      "ratings",
      "price",
      "location",
      "published_date",
      { author: ["slug", "name", "about", "avatar", "ratings_authors"] },
    ],
  })
);

const Ratings_authors = (ratings_author: string) => {
  switch (ratings_author) {
    case "Best Rated Seller":
      return "bg-yellow-700";
    case "High Rated Seller":
      return "bg-blue-600";
    case "Low Rated Seller":
      return "bg-red-700";
    case "Not Rated Seller":
      return "bg-gray-500";
    default:
      return "bg-gray-500";
  }
};

const check = (check_value: string, slug:string) => {
  switch (check_value === slug) {
    case true:
      return "";
    case false:
      return "hidden";
    default:
      return "hidden"; // Fallback für andere Fälle
  }
};

const Ratings = (rating: string) => {
  switch (rating) {
    case "Best Rated":
      return "bg-yellow-800";
    case "High Rated":
      return "bg-blue-600";
    case "Low Rated":
      return "bg-red-700";
    default:
      return "bg-blue-600";
  }
};
---

<Layout title={`Contact for ${auth.text}`}>
<main>

  <section>
    <!-- Container -->
    <div class="text-white mx-auto w-full max-w-7xl px-5 py-16 md:px-10 md:py-20">
      <!-- Component -->
      <div class="grid items-center gap-8 sm:gap-20 lg:grid-cols-2">
        <div class="max-w-3xl">
          <!-- Title -->
          <div class="mb-5 flex items-center rounded-md">
            <p transition:name={auth.author.ratings_authors} class={`p-2 rounded-full text-sm ${Ratings_authors(auth.author.ratings_authors)}`}>{auth.author.ratings_authors}</p>
          </div>
          <h2 transition:name={auth.author.name} class="mb-2 text-3xl font-bold md:text-5xl">Contact {auth.author.name} </h2>
          <p class="my-4 max-w-lg pb-4 text-[2px] text-gray-500 sm:text-base md:mb-6 lg:mb-8">Intrested In buying or making a deal on {auth.text}?<br> Just contact {auth.author.name} the owner of {auth.text}</p>
          <Picture src={`https://directus-dev.fly.dev/assets/${auth.author.avatar}?width=500`} alt="Layla kruz" height={500} width={500} class="rounded-xl mr-2 inline-block object-cover h-[500px] w-full"/>
          <p class="border-t border-yellow-500 pt-5 mt-10 mb-8 max-w-lg text-sm text-gray-500 sm:text-base"> I Baught a home from {auth.author.name} One Time and it was super easy and than with homifyss as well it was just so great highly recommended!</p>
          <div class="flex">
            <Picture src={rating} alt="Connan Marco" class="mr-4 inline-block h-16 w-16 rounded-full object-cover"/>
            <div class="flex flex-col">
              <h6 class="text-base font-bold">Connan Marco</h6>
              <p class="text-sm text-gray-500">Buyer</p>
            </div>
          </div>
        </div>
        <div transition:animate="slide" class="w-[500px] mx-auto bg-black p-8 text-center">
          <h3 class="text-2xl font-bold md:text-3xl">Contact {auth.author.name}</h3>
          <p class="mx-auto mb-6 mt-4 max-w-lg text-sm text-gray-100 lg:mb-8">{auth.author.name} will be getting back to you in 48 hours</p>
          <p class="mx-auto mb-6 max-w-lg text-sm bg-red-700 p-2 rounded-full text-gray-100 lg:mb-8"> This Contact form is not working its just for funn :) </p>
          <!-- Form -->
          <form class="mx-auto mb-4 max-w-sm text-left" name="wf-form-password" method="get">
            <div>
              <label class="mb-1 font-medium"> Your Name </label>
              <input type="text" class="mb-4 block h-9 w-full rounded-md border border-solid border-black px-3 py-6 pl-4 text-sm text-black" required/>
            </div>
            <div class="mb-2">
              <label class="mb-1 font-medium"> Email Address </label>
              <input type="text" class="mb-4 block h-9 w-full rounded-md border border-solid border-black px-3 py-6 pl-4 text-sm text-black" required/>
            </div>
            <div class="mb-5 md:mb-6 lg:mb-8">
              <label class="mb-1 font-medium"> Message </label>
              <textarea placeholder="" maxlength="5000" name="field" class="mb-2.5 block h-auto min-h-32 w-full rounded-md border border-solid border-black p-3 text-sm text-black" required></textarea>
            </div>
            <input type="submit" value="Contact" class="mt-10 inline-block w-full cursor-pointer rounded-md bg-white px-6 py-3 text-center font-semibold text-black hover:bg-yellow-500 hover:text-black hover:scale-110 transition"/>
          </form>
        </div>
      </div>
    </div>
  </section>
<div class="mt-20 text-white mx-auto mb-8 max-w-3xl text-center">
  <h2 class="mb-4 mt-6 text-sm font-bold md:text-3xl">
    Intrested in buying a home from {auth.author.name}
  </h2>
  <p class="mx-auto mt-4 text-gray-500">
    These are homes from {auth.author.name} on the market ready to get baught!
  </p>
</div>
<ul class="grid grid-cols-1 sm:grid-cols-1 md:grid-cols-3 md:gap-10 p-5 text-white">
  {
    posts.reverse().map((post) => (
      <li class={`${check(post.author.name, auth.author.name)} rounded-3xl hover:scale-105 transition`}>
        <section>
          <div class="md:mb-40 text-white mx-auto mb-8 max-w-3xl text-center">
            <div>
              <a
                href={`/homes/${post.slug}`}
                class={`border border-yellow-500 p-5 flex-col gap-4 rounded-3xl px-4 md:px-2 flex`}
              >
                <img
                  alt=""
                  src={`https://directus-dev.fly.dev/assets/${post.image}?width=500`}
                  class="inline h-60 w-full rounded-2xl object-cover"
                />
                <div class="flex h-full w-full flex-col items-start justify-around px-0 py-4">
                  <div class="mb-5 flex flex-col items-start gap-2">
                    <div class="rounded-md bg-black text-blue-600 font-semibold px-2 py-1.5">
                      <p class="text-gradient-price">{post.price}</p>
                    </div>
                    <p class="text-lg font-bold md:text-xl tracking-wide">Name: {post.text}</p>
                    <p class="text-lg font-bold md:text-xl tracking-wide">Location: {post.location}</p>
                    <p class="text-lg font-bold md:text-xl tracking-wide">Published: {post.published_date}</p>
                  </div>
                  <div class="border-t border-yellow-500 w-full mb-5"></div>
                  <div class="flex items-center gap-11 sm:flex-row">
                    <div class="text-[#1d1d1d] p-1 rounded-xl homeinfoBg flex items-center">
                      <p class="mr-3 hidden md:flex">Owner:</p>
                      <Picture src={`https://directus-dev.fly.dev/assets/${post.author.avatar}?width=500`} alt="Layla kruz" height={500} width={500} class="mr-2 inline-block rounded-full object-cover h-7 w-7 sm:h-7" />
                      <p class="text-sm font-bold">{post.author.name}</p>
                    </div>
                    <div class="flex items-center">
                      <p class={`ml-1 xl:ml-32 text-sm font-bold p-2 rounded-full sm:flex ${Ratings(post.ratings)}`}>{post.ratings}</p>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </section>
      </li>
    ))
  }
</ul>

</main>
</Layout>